// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import {Script, console} from "forge-std/Script.sol";
import {VerifierProveRSA65537SHA256} from "../src/verifiers/prove/Verifier_prove_rsa_65537_sha256.sol";
import {IProofOfPassportRegister} from "../src/interfaces/IProofOfPassportRegister.sol";

abstract contract CodeConstants {
    uint256 public constant MAINNET_ETH_CHAIN_ID = 1;
    uint256 public constant ETH_SEPOLIA_CHAIN_ID = 11155111;
    uint256 public constant LOCAL_CHAIN_ID = 31337;

    uint256 public constant SIGNATURE_ALGORITHM_RSA_65537_SHA256 = 1;
    uint256 public constant SIGNATURE_ALGORITHM_RSA_65537_SHA1 = 0;
    uint256 public constant SIGNATURE_ALGORITHM_RSA_PSS_65537_SHA256 = 1;

    uint256 public constant NULLIFIER_INDEX_IN_PUB_SIGNAL = 4;

    uint256 public constant SIGNATURE_ALGORITHM_INDEX_IN_PUB_SIGNALS = 0;

    uint256 public constant NULLIFIER = uint256(0);

    uint256[] public initialSignatureAlgorithms;
    address[] public initialVerifiers;
    uint256[] public initialNullifiersIndexesInPubSigArray;
    address[] public initialSigners;

    uint256 public DEFAULT_ANVIL_KEY = 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80;
    address public DEFAULT_ANVIL_ADDRESS = 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266;

    IProofOfPassportRegister.Proof internal SHA256_RSA_65537_PROOF = IProofOfPassportRegister.Proof({
        a: [
            uint256(0x01b78f980b8152fe9cd995ec2a8eae33ac2917d9d726ede095a7e6b65b644556),
            uint256(0x1862a51302535bf2a1276688483e6a136816ac192ca864a4b7f6597ce6a34f3f)
        ],
        b: [
            [
                uint256(0x19fb8b0a5f7219b0ff67346f295dd3c2fd920ed3f5d8236c4afb3335ef30aeaf),
                uint256(0x0366809df7b10b9da74bdd45817f46c7224c510d9bf7445f06ac933a6f9b84d9)
            ],
            [
                uint256(0x0a456c23cc546dff592a3cf495a63ed30e3b4bcee867b73b325ad324e12f1f7d),
                uint256(0x2b966e64d1e60f9a286bbf894730fac55dcf406c0a310c17e7adf896ed90fb5d)
            ]
        ],
        c: [
            uint256(0x0af4668a831fc08c2ec65ef262be1b14b14e2391185c718ede19744743db98c3),
            uint256(0x230b621b8105f5aef21ddaa9d25065e61de68acb8a7130d17f602234d6a590d1)
        ],
        pubSignals: [
            uint256(0x0000000000000000000000000000000000000000000000000000000000000001),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000),
            uint256(0x0000000038310000000000000000000000000000000000000000000000000000),
            uint256(0x2ced155025b295d20bb504520d5d9d6072a11ed3c7637768a194ac06e9e21766),
            uint256(0x00000000000000000000000000000000000000000000000053411f824698fa2f),
            uint256(0x000000000000000000000000000000000000000000000000ff1d688bd8e828cb),
            uint256(0x000000000000000000000000000000000000000000000000bd8326134c5a6786),
            uint256(0x0000000000000000000000000000000000000000000000000afe5ec7730a32f4),
            uint256(0x0000000000000000000000000000000000000000000000002a0e6a5ec80d4fce),
            uint256(0x000000000000000000000000000000000000000000000000f2fe65e24f796c82),
            uint256(0x000000000000000000000000000000000000000000000000f003e5f6e0fb76f5),
            uint256(0x000000000000000000000000000000000000000000000000f7f0b8b4f7d16ba1),
            uint256(0x000000000000000000000000000000000000000000000000c0a50b9f9a009b2c),
            uint256(0x000000000000000000000000000000000000000000000000aa4b7930bc60289b),
            uint256(0x000000000000000000000000000000000000000000000000ee44f0d84ddcfd28),
            uint256(0x0000000000000000000000000000000000000000000000003d192c791c3d8393),
            uint256(0x000000000000000000000000000000000000000000000000940fdda1df29a07a),
            uint256(0x000000000000000000000000000000000000000000000000b2cb8508124d8a7c),
            uint256(0x000000000000000000000000000000000000000000000000e11251c45d7bbb8e),
            uint256(0x00000000000000000000000000000000000000000000000071257465ea50c505),
            uint256(0x0000000000000000000000000000000000000000000000001ad23eb19cfa74b5),
            uint256(0x000000000000000000000000000000000000000000000000085050985a12e3b6),
            uint256(0x000000000000000000000000000000000000000000000000cd67cb092d9e8b18),
            uint256(0x0000000000000000000000000000000000000000000000006453346761251ae4),
            uint256(0x00000000000000000000000000000000000000000000000076cceeb03dd248fa),
            uint256(0x000000000000000000000000000000000000000000000000832d5907c2ad2ce9),
            uint256(0x000000000000000000000000000000000000000000000000a277cc8ca629bee5),
            uint256(0x00000000000000000000000000000000000000000000000049ac2c66b33ce9d6),
            uint256(0x000000000000000000000000000000000000000000000000ed637fc977dbb3cd),
            uint256(0x000000000000000000000000000000000000000000000000c9fd54e162a1ca3f),
            uint256(0x0000000000000000000000000000000000000000000000003a4330c1fec63b6b),
            uint256(0x000000000000000000000000000000000000000000000000ad24b71325166d44),
            uint256(0x0000000000000000000000000000000000000000000000006dfc0e830acc6b6f),
            uint256(0x00000000000000000000000000000000000000000000000004f4b44e0821e867),
            uint256(0x000000000000000000000000000000000000000000000000a7161769a43e3175),
            uint256(0x000000000000000000000000000000000000000000000000db99fbc3b7a9901c),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000418),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000002),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000004),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000001),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000004),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000)
        ]
    });

    IProofOfPassportRegister.Proof internal SHA1_RSA_65537_PROOF = IProofOfPassportRegister.Proof({
        a: [
            uint256(0x12b6e38fcd518118c5cadf3c97689e2e67425490df01dbfb79a5f020a8994796),
            uint256(0x2ea837699b46845c0ffbbaf6658021208ede473c1442d1cc9b6bac47fa6ca0e7)
        ],
        b: [
            [
                uint256(0x2d0cf26aa51eb2e3e88547664dcf0b8a880eaf06d4c59200bfc57238bd250128),
                uint256(0x1dce29f6576dc018002f7edfc6d4f98123709ca4da118871dc4fe413e7e367b5)
            ],
            [
                uint256(0x284bf168e018cc9f1dfdb9db4fa9e922f93fa61ab94e58cf2c87c0f925b1ee07),
                uint256(0x01d7697d819a5340ab8a0b9cd92a3a48ab549e84c1e54464c77e3e93ae19ede7)
            ]
        ],
        c: [
            uint256(0x2720185ef00ceaecefe86025a462c73d22cd6504997a9b5f45ca4306de69bd4a),
            uint256(0x09524eeb5ed6cf3a935d7b91ab53892aa022cfbe78e057646d5a5e1e4c82ba42)
        ],
        pubSignals: [
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000),
            uint256(0x0000000038310000000000000000000000000000000000000000000000000000),
            uint256(0x12a5ee265d9b4ac6990f5116299dffb04c76b5afbedc85d9f0f5032942596e38),
            uint256(0x0000000000000000000000000000000000000000000000004a42acd329876dc3),
            uint256(0x0000000000000000000000000000000000000000000000008a0c30f2e8aef697),
            uint256(0x0000000000000000000000000000000000000000000000007b6165f92860301e),
            uint256(0x000000000000000000000000000000000000000000000000479934def26b69b6),
            uint256(0x000000000000000000000000000000000000000000000000bc54c0eb61a2e77b),
            uint256(0x000000000000000000000000000000000000000000000000cc5a5391770db266),
            uint256(0x000000000000000000000000000000000000000000000000dc6192745bb0da12),
            uint256(0x00000000000000000000000000000000000000000000000082a7fad0268fc98c),
            uint256(0x000000000000000000000000000000000000000000000000bca5851380f4f0ec),
            uint256(0x000000000000000000000000000000000000000000000000c6de00864055128b),
            uint256(0x00000000000000000000000000000000000000000000000003e9e516ae41f5ad),
            uint256(0x000000000000000000000000000000000000000000000000f29efd222eb1251e),
            uint256(0x0000000000000000000000000000000000000000000000009f0edd33e35f68d2),
            uint256(0x0000000000000000000000000000000000000000000000005e4c5a0ae5e07606),
            uint256(0x000000000000000000000000000000000000000000000000e59f242de9fc6d4b),
            uint256(0x000000000000000000000000000000000000000000000000010e743255401f25),
            uint256(0x0000000000000000000000000000000000000000000000001c1e907b7a0526d9),
            uint256(0x00000000000000000000000000000000000000000000000026b4d2f93b8d7400),
            uint256(0x000000000000000000000000000000000000000000000000309dc1c691b869ea),
            uint256(0x00000000000000000000000000000000000000000000000064ac68b6ae86ca59),
            uint256(0x000000000000000000000000000000000000000000000000248f2beddf4689c1),
            uint256(0x000000000000000000000000000000000000000000000000160f21275532f287),
            uint256(0x000000000000000000000000000000000000000000000000771ec9057be8e47b),
            uint256(0x00000000000000000000000000000000000000000000000043915dd0028addd1),
            uint256(0x0000000000000000000000000000000000000000000000002dd771374ee5d86e),
            uint256(0x0000000000000000000000000000000000000000000000005e2a5817e19e50ed),
            uint256(0x000000000000000000000000000000000000000000000000c25f285d4ceef999),
            uint256(0x000000000000000000000000000000000000000000000000234229c7008ccf51),
            uint256(0x000000000000000000000000000000000000000000000000e0dd64eb3c89f343),
            uint256(0x000000000000000000000000000000000000000000000000e953c6158a1aa7fd),
            uint256(0x0000000000000000000000000000000000000000000000009fed398611efc871),
            uint256(0x000000000000000000000000000000000000000000000000b215658e3dcd3d73),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000418),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000002),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000004),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000001),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000004),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000)
        ]
    });

    IProofOfPassportRegister.Proof internal SHA256_RSA_PSS_65537_PROOF = IProofOfPassportRegister.Proof({
        a: [
            uint256(0x16fb0440db68a5b76c214955b4b4a589d0975bc0705d02a9f1188ef94d79d818),
            uint256(0x18c88dcb7dee8a5cec63ab825ddcd305e328cd3969f2f5a8a10b29455b319f88)
        ],
        b: [
            [
                uint256(0x023758e8999d27fa43fd8c1b68e465db27a5461aa384ffe4c5e2998a089a7fae),
                uint256(0x013abb47f253ec15fadd53bd0982d001ce576b2d763ff087c1803b34403bbdf7)
            ],
            [
                uint256(0x15da986885dec3f51871e480e0026e61ba7df8a23410c8061016b37002e9b189),
                uint256(0x2e9945d6308f2bb6470b00e6e7411f2852302ff3e43fb67444c8a4494ed792b5)
            ]
        ],
        c: [
            uint256(0x244fdd6f2fb3d85a9b1668a5271d75bff184c714b06895af5681cb98b1209013),
            uint256(0x0df147be287b12b40944104d7586da6d78b4ceac7ea1bafd5ecd4e0a874ebb0f)
        ],
        pubSignals: [
            uint256(0x0000000000000000000000000000000000000000000000000000000000000001),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000),
            uint256(0x0000000038310000000000000000000000000000000000000000000000000000),
            uint256(0x19605cc642747f3b686cdc0cf0ddcf636deb10db3fb8b7a9209200c866e67a62),
            uint256(0x0000000000000000000000000000000000000000000000001402946428b4f511),
            uint256(0x000000000000000000000000000000000000000000000000f7888e17e6334b03),
            uint256(0x000000000000000000000000000000000000000000000000c3af317e70a9ebb4),
            uint256(0x000000000000000000000000000000000000000000000000751dc3fdf81cf16e),
            uint256(0x0000000000000000000000000000000000000000000000004fc85174df3c0ebb),
            uint256(0x000000000000000000000000000000000000000000000000715f1893c4c90ef0),
            uint256(0x0000000000000000000000000000000000000000000000006e1382bd0c8064cd),
            uint256(0x000000000000000000000000000000000000000000000000d63bb36b91452753),
            uint256(0x000000000000000000000000000000000000000000000000fc6d05970c9bca91),
            uint256(0x0000000000000000000000000000000000000000000000008d84084f0043acd2),
            uint256(0x00000000000000000000000000000000000000000000000045681a0cf06c6f83),
            uint256(0x000000000000000000000000000000000000000000000000becc8d6fd1499aec),
            uint256(0x000000000000000000000000000000000000000000000000acfef338044f482d),
            uint256(0x000000000000000000000000000000000000000000000000e9d8b428337c0404),
            uint256(0x000000000000000000000000000000000000000000000000e90dfe55fd68fb90),
            uint256(0x000000000000000000000000000000000000000000000000a5149589a795b7c4),
            uint256(0x0000000000000000000000000000000000000000000000007a006a746be3726b),
            uint256(0x000000000000000000000000000000000000000000000000aff4cb7688e522b3),
            uint256(0x000000000000000000000000000000000000000000000000d57df3abd6eb1170),
            uint256(0x000000000000000000000000000000000000000000000000fd3d6124bc10dfe3),
            uint256(0x00000000000000000000000000000000000000000000000066835ce3dbe6b647),
            uint256(0x000000000000000000000000000000000000000000000000a22beda540d1f620),
            uint256(0x000000000000000000000000000000000000000000000000095e5aa9405be553),
            uint256(0x000000000000000000000000000000000000000000000000f3685db5b6bd48ea),
            uint256(0x000000000000000000000000000000000000000000000000ccdbc40af2feb0f9),
            uint256(0x000000000000000000000000000000000000000000000000a3b62190ca1a2308),
            uint256(0x0000000000000000000000000000000000000000000000008347e60d171c42f5),
            uint256(0x000000000000000000000000000000000000000000000000740a3806f568f057),
            uint256(0x000000000000000000000000000000000000000000000000557e6eb412cc5857),
            uint256(0x0000000000000000000000000000000000000000000000009465792fb0488b44),
            uint256(0x000000000000000000000000000000000000000000000000c078c4ae20ffc713),
            uint256(0x000000000000000000000000000000000000000000000000c1c7212416c29d43),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000418),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000002),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000004),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000001),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000004),
            uint256(0x0000000000000000000000000000000000000000000000000000000000000000)
        ]
    });
}

contract HelperConfig is CodeConstants, Script {
    error HelperConfig__InvalidChainId();

    struct NetworkConfig {
        uint256[] signatureAlgorithms;
        address[] verifiers;
        uint256[] nullifiersIndexesInPubSigArray;
        address[] signers;
        uint256 deployerKey;
    }

    NetworkConfig public networkConfig;
    mapping(uint256 => NetworkConfig) public networkConfigs;

    constructor() {
        networkConfigs[LOCAL_CHAIN_ID] = getOrCreateAnvilEthConfig();
    }

    function getConfigByChainId(uint256 chainId) public returns (NetworkConfig memory) {
        if (networkConfig.verifiers.length > 0 && networkConfigs[chainId].verifiers[0] != address(0)) {
            return networkConfigs[chainId];
        } else if (chainId == LOCAL_CHAIN_ID) {
            return getOrCreateAnvilEthConfig();
        } else {
            revert HelperConfig__InvalidChainId();
        }
    }

    function getConfig() public returns (NetworkConfig memory) {
        return getConfigByChainId(block.chainid);
    }

    function getOrCreateAnvilEthConfig() public returns (NetworkConfig memory) {
        // Check to see if we set an active network config
        if (networkConfig.verifiers.length > 0 && networkConfig.verifiers[0] != address(0)) {
            return networkConfig;
        }

        initialSignatureAlgorithms.push(SIGNATURE_ALGORITHM_RSA_65537_SHA256);

        // Get Signer
        address SIGNER = makeAddr("signer");

        initialSigners.push(SIGNER);
        initialNullifiersIndexesInPubSigArray.push(NULLIFIER_INDEX_IN_PUB_SIGNAL);

        // Deploy the verifier contract
        vm.startBroadcast();
        VerifierProveRSA65537SHA256 verifierProveRSA65537SHA256 = new VerifierProveRSA65537SHA256();
        vm.stopBroadcast();

        initialVerifiers.push(address(verifierProveRSA65537SHA256));

        networkConfig = NetworkConfig({
            signatureAlgorithms: initialSignatureAlgorithms,
            verifiers: initialVerifiers,
            nullifiersIndexesInPubSigArray: initialNullifiersIndexesInPubSigArray,
            signers: initialSigners,
            deployerKey: DEFAULT_ANVIL_KEY
        });

        return networkConfig;
    }
}
